{% extends "./master/layout.html" %}
{% block title %}Compress PDF - Compactify{% endblock %}
{% block head %} {{ super() }} {% endblock %}
{% block content %}

<script>
  function validateFile(file) {
    const allowedExtensions = ['pdf'];
    const filename = file.name.toLowerCase();
    const fileExtension = filename.substring(filename.lastIndexOf('.') + 1);
    console.log('Ekstensi file:', fileExtension);

    if (!allowedExtensions.includes(fileExtension)) {
      return false;
    }

    return true;
  }

  function handleFileChange(event) {
    const file = event.target.files[0];
    if (!file) return null;
    return validateFile(file);
  }

  function pdfCompressor() {
    return {
      selectedFile: null,
      errorMessage: '',
      isDragOver: false,
      isProcessing: false,

      handleFileSelect(event) {
        const file = event.target.files[0];
        this.validateAndSetFile(file);
      },

      handleDrop(event) {
        this.isDragOver = false;
        const file = event.dataTransfer.files[0];
        this.validateAndSetFile(file);
      },

      validateAndSetFile(file) {
        if (!file) return;
        
        const allowedTypes = ['application/pdf'];
        const maxSize = 20 * 1024 * 1024; // 20MB
        
        if (!allowedTypes.includes(file.type)) {
          this.errorMessage = 'Please select a valid PDF file';
          return;
        }
        
        if (file.size > maxSize) {
          this.errorMessage = 'File size must be less than 20MB';
          return;
        }
        
        this.selectedFile = file;
        this.errorMessage = '';
      },

      clearFile() {
        this.selectedFile = null;
        this.errorMessage = '';
        document.querySelector('input[type="file"]').value = '';
      },

      formatFileSize(bytes) {
        if (!bytes) return '';
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(1024));
        return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
      },

      handleSubmit(event) {
        if (!this.selectedFile) {
          event.preventDefault();
          this.errorMessage = 'Please select a PDF file first';
          return;
        }
        this.isProcessing = true;
      }
    }
  }
</script>  
<!-- Background with gradient -->
<div class="min-h-screen py-8 bg-gradient-to-br from-red-50 via-white to-orange-50">
  <div class="container px-4 mx-auto">
    <!-- Main Card -->
    <div class="max-w-2xl mx-auto">
      <div class="overflow-hidden bg-white border border-gray-100 shadow-2xl rounded-3xl">
        <!-- Header Section -->
        <div class="px-8 py-12 text-center bg-gradient-to-r from-red-600 to-orange-600">
          <div class="flex justify-center mb-6">
            <div class="p-4 rounded-full bg-white/20 backdrop-blur-sm">
              <img src="{{ url_for('static', filename='image/logo.png') }}" class="w-auto h-16" alt="Compactify Logo" />
            </div>
          </div>
          <h1 class="mb-2 text-3xl font-bold text-white">Compress PDF</h1>
          <p class="text-red-100">Reduce PDF file size while maintaining quality</p>
        </div>
        
        <!-- Form Section -->
        <div class="p-8">
          <form x-data="pdfCompressor()" @submit="handleSubmit($event)" action="{{ url_for('compresspdf') }}" method="POST" enctype="multipart/form-data">
            
            <!-- File Upload Area -->
            <div class="mb-8">
              <div 
                class="relative p-8 text-center transition-all duration-200 border-2 border-gray-300 border-dashed rounded-2xl hover:border-red-400 hover:bg-red-50/50"
                :class="{ 'border-red-500 bg-red-50': isDragOver, 'border-green-500 bg-green-50': selectedFile }"
                @dragover.prevent="isDragOver = true"
                @dragleave.prevent="isDragOver = false"
                @drop.prevent="handleDrop($event)"
              >
                
                <!-- Default State -->
                <div x-show="!selectedFile" class="space-y-4">
                  <div class="flex items-center justify-center w-20 h-20 mx-auto bg-red-100 rounded-full">
                    <i class="text-3xl text-red-600 fas fa-file-pdf"></i>
                  </div>
                  <div>
                    <h3 class="mb-2 text-xl font-semibold text-gray-800">Drop your PDF file here</h3>
                    <p class="mb-4 text-gray-500">or click to browse files</p>
                    <p class="text-sm text-gray-400">Supports: PDF (Max: 20MB)</p>
                  </div>
                </div>
                
                <!-- Selected File Preview -->
                <div x-show="selectedFile" class="space-y-4">
                  <div class="flex items-center justify-center w-16 h-16 mx-auto bg-green-100 rounded-full">
                    <i class="text-2xl text-green-600 fas fa-check"></i>
                  </div>
                  <div>
                    <p class="text-lg font-semibold text-gray-800" x-text="selectedFile?.name"></p>
                    <p class="text-gray-500" x-text="formatFileSize(selectedFile?.size)"></p>
                  </div>
                  <button 
                    type="button" 
                    @click="clearFile()"
                    class="font-medium text-red-600 transition-colors duration-200 hover:text-red-700"
                  >
                    <i class="mr-1 fas fa-times"></i>Remove file
                  </button>
                </div>
                
                <input 
                  type="file" 
                  name="file" 
                  accept=".pdf"
                  @change="handleFileSelect($event)"
                  class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                />
              </div>
              
              <!-- Error Message -->
              <div x-show="errorMessage" class="p-4 mt-4 border border-red-200 rounded-lg bg-red-50">
                <div class="flex items-center">
                  <i class="mr-2 text-red-600 fas fa-exclamation-triangle"></i>
                  <p class="font-medium text-red-700" x-text="errorMessage"></p>
                </div>
              </div>
            </div>

            <!-- Compression Options -->
            <div class="mb-8" x-show="selectedFile">
              <label class="block mb-4 text-lg font-semibold text-gray-800">
                <i class="mr-2 text-red-600 fas fa-sliders-h"></i>
                Compression Level
              </label>
              <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                <label class="relative cursor-pointer">
                  <input type="radio" name="quality" value="high" checked class="sr-only peer">
                  <div class="p-4 transition-all duration-200 border-2 border-gray-200 rounded-xl peer-checked:border-red-500 peer-checked:bg-red-50">
                    <div class="text-center">
                      <div class="flex items-center justify-center w-12 h-12 mx-auto mb-2 bg-green-100 rounded-full">
                        <i class="text-green-600 fas fa-gem"></i>
                      </div>
                      <h4 class="font-semibold text-gray-800">High Quality</h4>
                      <p class="text-sm text-gray-600">Best quality, moderate compression</p>
                    </div>
                  </div>
                </label>
                
                <label class="relative cursor-pointer">
                  <input type="radio" name="quality" value="medium" class="sr-only peer">
                  <div class="p-4 transition-all duration-200 border-2 border-gray-200 rounded-xl peer-checked:border-red-500 peer-checked:bg-red-50">
                    <div class="text-center">
                      <div class="flex items-center justify-center w-12 h-12 mx-auto mb-2 bg-yellow-100 rounded-full">
                        <i class="text-yellow-600 fas fa-balance-scale"></i>
                      </div>
                      <h4 class="font-semibold text-gray-800">Balanced</h4>
                      <p class="text-sm text-gray-600">Good quality, better compression</p>
                    </div>
                  </div>
                </label>
                
                <label class="relative cursor-pointer">
                  <input type="radio" name="quality" value="low" class="sr-only peer">
                  <div class="p-4 transition-all duration-200 border-2 border-gray-200 rounded-xl peer-checked:border-red-500 peer-checked:bg-red-50">
                    <div class="text-center">
                      <div class="flex items-center justify-center w-12 h-12 mx-auto mb-2 bg-red-100 rounded-full">
                        <i class="text-red-600 fas fa-compress"></i>
                      </div>
                      <h4 class="font-semibold text-gray-800">High Compression</h4>
                      <p class="text-sm text-gray-600">Maximum compression, lower quality</p>
                    </div>
                  </div>
                </label>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center">
              <button 
                type="submit" 
                :disabled="!selectedFile || isProcessing"
                class="px-8 py-4 font-semibold text-white transition-all duration-300 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl hover:shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
              >
                <span x-show="!isProcessing" class="flex items-center">
                  <i class="mr-2 fas fa-file-pdf"></i>
                  Compress PDF
                </span>
                <span x-show="isProcessing" class="flex items-center">
                  <div class="w-5 h-5 mr-2 border-2 border-white rounded-full animate-spin border-t-transparent"></div>
                  Processing...
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}  