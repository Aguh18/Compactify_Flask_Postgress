{% extends "./master/layout.html" %}

{% block title %}
  Image to Grayscale - Compactify
{% endblock %}

{% block head %}
  {{ super() }}
{% endblock %}

{% block content %}
<script>
function imageToGrayscaleConverter() {
  return {
    selectedFile: null,
    isDragOver: false,
    isProcessing: false,
    errorMessage: '',

    handleFileSelect(event) {
      const file = event.target.files[0];
      this.validateAndSetFile(file);
    },

    handleDrop(event) {
      this.isDragOver = false;
      const file = event.dataTransfer.files[0];
      this.validateAndSetFile(file);
    },

    validateAndSetFile(file) {
      this.errorMessage = '';
      
      if (!file) return;

      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/bmp', 'image/webp'];
      const maxSize = 10 * 1024 * 1024;

      if (!allowedTypes.includes(file.type)) {
        this.errorMessage = 'Please select a valid image file (JPG, JPEG, PNG, GIF, BMP, or WebP)';
        return;
      }

      if (file.size > maxSize) {
        this.errorMessage = 'File size must be less than 10MB';
        return;
      }

      this.selectedFile = file;
      this.errorMessage = '';
    },

    clearFile() {
      this.selectedFile = null;
      this.errorMessage = '';
      document.querySelector('input[type="file"]').value = '';
    },

    formatFileSize(bytes) {
      if (!bytes) return '';
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(1024));
      return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    },

    handleSubmit(event) {
      if (!this.selectedFile) {
        event.preventDefault();
        this.errorMessage = 'Please select an image file first';
        return;
      }
      this.isProcessing = true;
      // Form akan dikirimkan secara normal
    }
  }
}
</script>

<!-- Background with gradient -->
<div class="min-h-screen py-8 bg-gradient-to-br from-gray-50 via-white to-slate-50">
  <div class="container px-4 mx-auto">
    <!-- Main Card -->
    <div class="max-w-2xl mx-auto">
      <div class="overflow-hidden bg-white border border-gray-100 shadow-2xl rounded-3xl">
        <!-- Header Section -->
        <div class="px-8 py-12 text-center bg-gradient-to-r from-gray-600 to-slate-900">
          <div class="flex justify-center mb-6">
            <div class="p-4 rounded-full bg-white/20 backdrop-blur-sm">
              <img src="{{ url_for('static', filename='image/logo.png') }}" class="w-auto h-16" alt="Compactify Logo" />
            </div>
          </div>
          <h1 class="mb-2 text-3xl font-bold text-white">Image to Grayscale</h1>
          <p class="text-gray-100">Convert your colorful images to elegant grayscale</p>
        </div>
        
        <!-- Form Section -->
        <div class="p-8">
          <form x-data="imageToGrayscaleConverter()" @submit="handleSubmit($event)" action="{{ url_for('imgtogray') }}" method="POST" enctype="multipart/form-data">
            
            <!-- File Upload Area -->
            <div class="mb-8">
              <div 
                class="relative p-8 text-center transition-all duration-200 border-2 border-gray-300 border-dashed rounded-2xl hover:border-gray-400 hover:bg-gray-50/50"
                :class="{ 'border-gray-500 bg-gray-50': isDragOver, 'border-green-500 bg-green-50': selectedFile }"
                @dragover.prevent="isDragOver = true"
                @dragleave.prevent="isDragOver = false"
                @drop.prevent="handleDrop($event)"
              >

                <input 
                  type="file" 
                  name="file" 
                  accept=".jpg,.jpeg,.png,.gif,.bmp,.webp"
                  @change="handleFileSelect($event)"
                  class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                />
                
                <!-- Default State -->
                <div x-show="!selectedFile" class="space-y-4">
                  <div class="flex items-center justify-center w-20 h-20 mx-auto bg-gray-100 rounded-full">
                    <i class="text-3xl text-gray-600 fas fa-cloud-upload-alt"></i>
                  </div>
                  <div>
                    <h3 class="mb-2 text-xl font-semibold text-gray-800">Drop your image here</h3>
                    <p class="mb-4 text-gray-500">or click to browse files</p>
                    <p class="text-sm text-gray-400">Supports: JPG, JPEG, PNG, GIF, BMP, WebP (Max: 10MB)</p>
                  </div>
                </div>
                
                <!-- Selected File Preview -->
                <div x-show="selectedFile" class="space-y-4">
                  <div class="flex items-center justify-center w-16 h-16 mx-auto bg-green-100 rounded-full">
                    <i class="text-2xl text-green-600 fas fa-check"></i>
                  </div>
                  <div>
                    <p class="text-lg font-semibold text-gray-800" x-text="selectedFile?.name"></p>
                    <p class="text-gray-500" x-text="formatFileSize(selectedFile?.size)"></p>
                  </div>
                  <button 
                    type="button" 
                    @click="clearFile()"
                    class="font-medium text-red-600 transition-colors duration-200 hover:text-red-700"
                  >
                    <i class="mr-1 fas fa-times"></i>Remove file
                  </button>
                </div>
              </div>
              
              <!-- Error Message -->
              <div x-show="errorMessage" class="p-4 mt-4 text-red-700 bg-red-100 border border-red-300 rounded-lg">
                <p x-text="errorMessage"></p>
              </div>
            </div>

            <!-- Convert Button -->
            <div class="flex flex-col items-center space-y-4">
              <button 
                type="submit" 
                :disabled="!selectedFile || isProcessing"
                :class="selectedFile && !isProcessing ? 'bg-gradient-to-r from-gray-600 to-slate-900 hover:from-gray-700 hover:to-slate-800 cursor-pointer' : 'bg-gray-400 cursor-not-allowed'"
                class="w-full px-8 py-4 text-lg font-semibold text-white transition-all duration-200 rounded-xl"
              >
                <span x-show="!isProcessing" class="flex items-center justify-center">
                  <i class="mr-2 fas fa-palette"></i>
                  Convert to Grayscale
                </span>
                <span x-show="isProcessing" class="flex items-center justify-center">
                  <i class="mr-2 fas fa-spinner fa-spin"></i>
                  Converting...
                </span>
              </button>
              
              <p class="text-sm text-center text-gray-500">
                Your image will be processed and converted to grayscale format
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div x-show="isProcessing" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" style="display: none;">
  <div class="max-w-sm p-8 mx-4 text-center bg-white rounded-2xl">
    <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full">
      <i class="text-2xl text-gray-600 fas fa-spinner fa-spin"></i>
    </div>
    <h3 class="mb-2 text-lg font-semibold text-gray-800">Converting to Grayscale</h3>
    <p class="text-gray-600">Please wait while we process your image...</p>
  </div>
</div>
{% endblock %}
  